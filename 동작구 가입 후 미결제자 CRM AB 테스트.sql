with p_user as (select distinct u.user_id
                              , u.user_name
--     , c.coupon_id
                              , case
                                    when u.user_id in
                                         (100299933, 100874900, 100363496, 100910669, 100879697, 100909246, 100799889,
                                          100791888, 100911489, 100297374, 100872806, 100796728, 100327752, 100269599,
                                          100803886, 100735766, 100658826, 100726919, 101065567, 100859313, 100895418,
                                          100871925, 100506185, 100875836, 100800964, 100229922, 100874630, 100942396,
                                          100874377, 100834690, 100446579, 100703526, 100666689, 100995627, 100869792,
                                          100863064, 101026899, 100862870, 100875324, 100805334, 100644561, 100100254,
                                          100533168, 100419040, 100779656, 100935983, 100872524, 100998897, 100991788,
                                          100884711, 100992952, 101041486, 100872467, 100996479, 100892025, 100905126,
                                          101052263, 100872869, 100459066, 100910963, 100895183, 100874722, 100793914,
                                          100835557, 101072904, 100941343, 100779684, 100375571, 100991412, 100879027,
                                          100769528, 100775316, 100901795, 100854438, 100286761, 100773476, 100615923,
                                          100379279, 100869604, 100148898, 100975003, 100878141, 100860133, 101015074,
                                          100335312, 100983686, 100489283, 100338325, 100472586, 100293017, 100867014,
                                          100168494, 100305970, 100875963, 100758714, 100931690, 100868254, 100656670,
                                          100666504, 100772932, 100836404, 100768749, 101080458, 100880771, 100896460,
                                          101073897, 100390314, 100749603, 100375307, 100719233, 100779578, 100434716,
                                          100931320, 100765189, 100215592, 100515301, 100895771, 100910310, 100454149,
                                          100888789, 100910908, 100805473, 100822815, 100451237, 100512858, 100095837,
                                          100339734, 100768846, 100191535, 100879936, 100995352, 100875116, 101015893,
                                          100810461, 100480873, 101046430, 100890141, 100364714, 101005843, 101076494,
                                          100727561, 100470749, 100497904, 100781974, 100859691, 100875707, 100488825,
                                          100846427, 100911176, 100863580, 100688238, 100538792, 100883734, 100798959,
                                          100654422, 100877658, 100838785, 100890052, 100634643, 100883424, 100749206,
                                          100894123, 100740307, 100294176, 100902835, 100879751, 101052458, 100952336,
                                          100974751, 101000213, 100928196, 100523590, 100785026, 100774945, 100296366,
                                          100983036, 101047607, 101033153, 100893743, 101010871, 100880649, 100851201,
                                          100865041, 100311169, 100745130, 100703103, 100773684, 100713412, 100754231,
                                          100296800, 100518758, 100096064, 100340009, 100899351, 100997729, 100752053,
                                          100298520, 100307212, 100863882, 100530534, 100486937, 101026283, 101013837,
                                          100829315, 100939277, 100200633, 100449855, 100055431, 100842970, 101066492,
                                          101041624, 100249502, 100468617, 100868213, 100222685, 100754413, 100893592,
                                          100943418, 100639895, 100872053, 100292911, 101003437, 100716674, 100312756,
                                          100321909, 100863122, 100958216, 100943165, 100922963, 100245468, 100765005,
                                          100853186, 100816925, 100894694, 100759240, 100880495, 101019374, 101041250,
                                          101038581, 100432723, 100858734, 100863019, 100960425, 100971208, 100943906,
                                          100892194, 100754958, 100162677, 100813082, 100614061, 100769940, 100863541,
                                          100079364, 100900911, 100366209, 100716722, 101025001, 101037058, 100854451,
                                          101067813, 100674249, 100791836, 100838607, 100905416, 100921790, 100859260,
                                          101037670, 101054708, 100892208, 100673849, 100197491, 100225756, 100777489,
                                          100868795, 100892947, 100864214, 100261470, 100885237, 100778894, 100760262,
                                          100863698, 100650159, 100804685, 100722902, 100895354, 100905165, 100763125,
                                          100872239, 100310998, 101013025, 100869770, 100815425, 100254747, 101005913,
                                          100868939, 101004640, 100276762, 100285036, 100975337, 100964675, 100881151,
                                          100343758, 100877364, 101030292, 100788483, 100968747, 100908425, 100718892,
                                          100995525, 100774147, 100991902, 100933871, 100897232, 101020816, 100214821,
                                          100468963, 100909510, 100307623, 100873983, 100838930, 100720786, 100902673,
                                          100755708, 100896774, 100301151, 100536956, 100215515, 100485614, 101011657,
                                          100861978, 100185433, 100376683, 100876880, 101001117, 100799555, 100832018,
                                          100911121, 100990501, 100901740, 100889045, 100695475, 100784900, 100802655,
                                          100533333, 100773225, 100904661, 100079008, 100801344, 100871286, 100348553,
                                          100883311, 100875386, 101064226, 100794171, 100985535, 100889076, 100828345,
                                          100858422, 100854961, 100395161, 100904156, 100862436, 100483834, 100315143,
                                          100849754, 100308420, 100775698, 100896959, 101079567, 100812019, 100994773,
                                          100004631, 100778207, 100989809, 100496647, 100840976, 100796587, 100258272,
                                          100897132, 100802556, 100196531, 101068958, 100684023, 100382270, 100289410,
                                          100812928, 100790706, 100825441, 100749394, 100955185, 101021195, 100230622,
                                          100227994, 100782780, 100801534, 101010877, 100787525, 100350104, 100933259,
                                          100674947, 100054210, 100880763, 100884989, 100450633, 100907917, 100541545,
                                          100184742, 101080844, 100834404, 100868692, 100878972, 100195207, 100860057,
                                          100363903, 100894506, 100277197, 101027129, 100894615, 100278543, 100914285,
                                          100860905, 100357770, 100873439, 100470156, 100655798, 100310814, 100699177,
                                          101053174, 100151083, 100748817, 100680758, 100904529, 100398156, 100849204,
                                          100974462, 100697074, 100956206, 100191450, 100947095, 100816358, 100864695,
                                          100894626, 101011288, 100784458, 100212180, 100878139, 100843071, 101015944,
                                          100864231, 101015896, 100727767, 100237912, 100787025, 100297343, 100872162,
                                          100835249, 100251492, 100696445, 100875574, 101034505, 100787039, 100864690,
                                          100922143, 100286355, 100909169, 100880308, 100770759, 100978901, 100874139,
                                          100830330, 100817686, 100884534, 100475377, 100418366, 100179316, 100670573,
                                          100351404, 100829284, 100889811, 101075250, 100649782, 100823946, 100968982,
                                          100628602, 100759756, 100233766, 100892070, 100882606, 100738875, 100591885,
                                          101063470, 100903786, 100860557, 100882370, 100934509, 100969753, 100839021,
                                          100806615, 100778284, 100619644, 100513167, 100537934, 100995747, 100486885,
                                          100877117, 100517305, 100407760, 100856178, 100318337, 101011469, 101040942,
                                          100512156, 100664253, 100898337, 100863114, 100884153, 100710119, 100971804,
                                          100484262, 100775833, 100757894, 100913463, 100906670, 100186138, 101065925,
                                          100885947, 100646621, 100573747, 100999757, 100118533, 100685880, 101043134,
                                          100750561, 100012250, 100900854, 100211608, 100883487, 101076328, 100924906,
                                          101077680, 100836022, 101033445, 100196897, 100865106, 100241197, 101064302,
                                          100887306, 100684811, 100804512, 100630033, 101067384, 100186448, 100471672,
                                          100483760, 100448876, 100855797, 100862068, 101020018, 100843938, 100586810,
                                          100786129, 100444800, 101079019, 101069963, 100237750, 100866647, 100215194,
                                          100260599, 100032518, 101013963, 100837061, 100872661, 100216014, 100978235,
                                          100884878, 100153372, 100900586, 100848696, 100272431, 100662178, 100838282,
                                          100904108, 100885811, 100895370, 101070987, 100832143, 100611908, 100286049,
                                          100906529, 100874066, 100890150, 100992868, 100843635, 100262099, 100995998,
                                          100810178, 100533722, 100663654, 100539777, 101006053, 100803986, 100361149,
                                          100226957, 100686028, 100391765, 100890162, 100316788, 100606891, 100796352,
                                          100902278, 100868329, 100758549, 100805365, 100852961, 100849318, 100886848,
                                          100910133, 100784471, 100548591, 100444089, 100153796, 100925957, 100950806,
                                          100893221, 100871983, 100643717, 100876637, 100275448, 100721587, 100359082,
                                          100644574, 100807615, 100772768, 100949012, 100790306, 100418344, 100773212,
                                          100859324, 100945344, 101080852, 101031178, 100868343, 100443341, 100839120,
                                          100207071, 100968203, 100878338, 100281500, 100764679, 100993593, 100803639,
                                          100418587, 100950844, 100743225, 100904136, 101024314, 100890221, 101053820,
                                          100436924, 100319376, 101008266, 100811194, 100858795, 101016913, 100972547,
                                          100883841, 100874175, 101010173, 101070057, 100664304, 100873150, 100877496,
                                          100985165, 100952019, 100881252, 100895473, 100642589, 100781411, 100985379,
                                          100463063, 100862578, 100894847, 100612432, 101031578, 100757608, 100850483,
                                          100216445, 100835202, 100900041, 100800084, 100912234, 100376967, 100344223,
                                          100281307, 100868849, 100335162, 101011977, 100937660, 100130752, 100227677,
                                          100760008, 101022270, 100868729, 100212486, 101015358, 100678761, 101051575,
                                          100882445, 101079931, 100864522, 100147344, 100976616, 100993286, 101003880,
                                          100983148, 100799371, 100651159, 100865318, 100891122, 100983237, 100881921,
                                          100872821, 101036440, 100912820, 100249888, 101076273, 100986221, 100353226,
                                          100787829, 100899797, 100242001, 101054934, 100163462, 100768920, 100775603,
                                          100984357, 101019983, 100589090, 100810017, 100793724, 100938309, 100858813,
                                          101044686, 101065303, 100881390, 100348984, 100214016, 100929667, 100301038,
                                          100482530, 100971652, 101066337, 100293197, 100257332, 100871793, 100876170,
                                          100370439, 100652126, 100479983, 100999590, 100796660, 100994164, 100054000,
                                          100799745, 100932706, 100766983, 100357643, 101005776, 101026498, 100867687,
                                          100897333, 100998803, 100293500, 100899503, 100936143, 100885660, 100307070,
                                          101019214, 101025985, 100808495, 100318443, 100816334, 100876621, 100904828,
                                          101043795, 100745438, 100832833, 100634052, 100541208, 100880941, 100994748,
                                          100958437, 100232672, 100947693, 100891455, 100992872, 100818680, 100789122,
                                          100573333, 100739371, 100837217, 100778888, 100874460, 100800137, 100404850,
                                          100790246, 100864456, 100857756, 100665752, 100730874, 100959709, 100193866,
                                          100699663, 100609568, 100987660, 101074875, 100811460, 100360600, 101063644,
                                          100322351, 100220751, 100880241, 100675918, 100836857, 100823974, 100564214,
                                          100634364, 101002692, 100082555, 100907268, 100887369, 101053482, 100664205,
                                          100837959, 100463468, 100761919, 100905805, 101033484, 100374611, 101034844,
                                          100878904, 100865458, 100920497, 100892198, 100367256, 101000233, 100744579,
                                          100921454, 100085614, 100752573, 100946874, 100883380, 100870959, 100634796,
                                          100943148, 100294681, 100872755, 100845031, 100705573, 101048759, 100666825,
                                          100705620, 100406513, 100424920, 100863943, 100890595, 100644444, 100620332,
                                          100272153, 100893733, 100707777, 100528061, 100637144, 100323525, 100721612,
                                          100054484, 100640481, 100773066, 100673129, 100866903, 100875648, 100872828,
                                          100691534, 100864730, 100858712, 100868693, 100948244, 100369039, 100291345,
                                          100934993, 100668633, 100861855, 100966877, 100869358, 100279088, 100653805,
                                          100860006, 100419257, 100199126, 100193195, 100831964, 100227168, 100634777,
                                          100876774, 100857464, 100221629, 100776531, 100762429, 100866857, 100316050,
                                          100754406, 100861810, 100226803, 100893577, 100096616, 100716176, 100469546,
                                          100387095, 100900708, 100885719, 101053348, 100863991, 100019845, 100900565,
                                          100416634, 100895677, 100899221, 100129171, 101028565, 100293231, 101015956,
                                          100876449, 101014419, 100729680, 100025075, 100976298, 100942354, 100476997,
                                          100652045, 101038857, 100662149, 100408175, 100709741, 101018709, 100877594,
                                          100869943, 100482988, 100896329, 100741430, 100042568, 100939419, 100695634,
                                          100861479, 100795078, 101020243, 100208681, 100989941, 100291745, 100815027,
                                          100794393, 100518593, 100436551, 100003127, 100893003, 100904681, 100865478,
                                          100005624, 100905812, 100820269, 100230775, 101001970, 100240865, 100739970,
                                          100774024, 100794458, 100855779, 100814342, 100785955, 100880609, 100881684,
                                          100642687, 101049668, 101011323, 100896112, 100529178, 100384763, 100871340,
                                          100592442, 100872231, 100218642, 101045762, 100334430, 100894989, 100809904,
                                          100904905, 100003855, 100370001, 100617963, 101042025, 100874498, 100012203,
                                          100835346, 100876316, 100887655, 101020263, 100777410, 100300823, 100895329,
                                          100851461, 100863345, 100992669, 100528950, 100482855, 100933846, 100882435,
                                          100506863, 100603735, 100431990, 100904582, 100214028, 100863952, 100835842,
                                          100951828, 100807292, 100941594, 100778961, 100275235, 100680933, 100990792,
                                          101006523, 100849721, 100709804, 101047891, 100894799, 100625563, 100118922,
                                          100897568, 100859204, 100980548, 100527324, 101077966, 100984462, 101044399,
                                          100802679, 100617807, 101075868, 100242095, 100911901, 100828976, 100879865,
                                          101015837, 100788925, 100897044, 100190355, 100844206, 100536319, 100897222,
                                          100867960, 100899075, 100978222, 100145033, 100905495, 100454811, 100209187,
                                          100895469, 100423113, 100975458, 100930404, 101032100, 100879941, 100809196,
                                          100677563, 101053501, 100866452, 100826032, 100778101, 100979461, 100835535,
                                          100713435, 100251863, 100904268, 100773261, 100895745, 100984216, 101080931,
                                          100869357, 100865403, 101032993, 100965627, 100787642, 100171935, 101058241,
                                          100219677, 100918704, 100945797, 100736477, 100617449, 100887370, 100677035,
                                          100241520, 100695195, 100188335, 100661136, 100860892, 100871839, 100210390,
                                          100520446, 100997782, 100190062, 100772270, 101012694, 100192353, 100359372,
                                          100884424, 101073803, 100880914, 101054048, 100813499, 100329945, 101079953,
                                          100310212, 100881347, 100671384, 100264711, 100847662, 100470344, 101027704,
                                          100171709, 100768660, 100711248, 100960862, 100728921, 100889047, 100774228,
                                          100808158, 100781699, 100750089, 100863247, 100199049, 100895326, 100874539,
                                          100816490, 100979387, 100917669, 101023350, 100977569, 100909161, 100299511,
                                          100863647, 100785738, 101079258, 100997629, 100876328, 100362461, 100881256,
                                          100705665, 100868454, 100816888, 100152047, 100602232, 100800255, 100245768,
                                          100638641, 100291986, 100865544, 100867130, 100816229, 100817809, 100883303,
                                          100937420, 100919310, 100450782, 101072103, 100894373, 101066557, 100896237,
                                          100476981, 100639999, 100895633, 100868054, 101024102, 101009191, 100448656,
                                          100719676, 100023125, 100928285, 100907296, 100974793, 101026593, 101010712,
                                          100238332, 100825160, 100864486, 100261878, 100864764, 100792241, 100861712,
                                          100897549, 100760946, 100584434, 100474748, 100346703, 100772789, 100846931,
                                          101061424, 100761681, 100868507, 100736241, 100819871, 100192784, 100668968,
                                          100869750, 100986521, 100792719, 100872433, 100908158, 100163197, 100896340,
                                          100778046, 101053063, 100375632, 100405611, 100962130, 100600720, 100540808,
                                          100860953, 100225699, 100909728, 100851595, 100890873, 100876711, 100956742,
                                          100790967, 100579399, 100901525, 100933556, 100450339, 100898433, 100190572,
                                          100877238, 100919357, 100753046, 100991523, 100920365, 100838020, 100797197,
                                          100221248, 101080712, 100098414, 100814976, 100145799, 100881452, 100387233,
                                          100790833, 100904378, 100862706, 100689110, 101011425, 100638775, 100891772,
                                          100993067, 100318676, 100222259, 100474719, 100853412, 100807356, 100879317,
                                          100302016, 100908526, 100684298, 100238400, 100700615, 101019511, 100904836,
                                          100552630, 100939459, 100875669, 100798283, 101035005, 100812220, 100957043,
                                          100987244, 100282156, 100273841, 100876653, 100876715, 100871531, 100900439,
                                          100937520, 101043130, 100184925, 100774411, 100013740, 100959420, 101049280,
                                          100845541, 100095606, 100883797, 100785594, 100651037, 100805323, 100702515,
                                          100786457, 100800775, 100826351, 100588449, 101077075, 100900975, 100964054,
                                          100908770, 101069256, 100908070, 100746836, 100908077, 100654098, 100348750,
                                          100460218)
                                        then 'A'
                                    when u.user_id in
                                         (100459002, 100790523, 100790600, 100933945, 100256102, 100785475, 101015444,
                                          100276326, 101078022, 100943073, 101004854, 100750966, 100120282, 100926724,
                                          100891999, 100737782, 100354590, 100828233, 101076189, 100892514, 100774637,
                                          100163882, 100867928, 100005633, 100804209, 101069044, 100892128, 100234432,
                                          100233091, 101021573, 100952779, 101030309, 100890761, 100944164, 100866727,
                                          100776117, 100289412, 100860884, 100890513, 100905260, 100824766, 100803167,
                                          100077310, 100017186, 100663314, 100927648, 101023119, 100888259, 100866574,
                                          101037785, 100822428, 100048975, 100299142, 100797237, 100272326, 100454665,
                                          100511224, 100948365, 100735310, 100865260, 100985908, 100819032, 101046771,
                                          100821740, 100967003, 101056596, 100811786, 100233940, 100856830, 100194056,
                                          100073561, 100410320, 101066780, 101012880, 100886775, 100894955, 100950377,
                                          100638693, 100603306, 100861520, 100195782, 100874075, 100453658, 101016159,
                                          100960848, 100742086, 100503228, 100152561, 100863978, 100328054, 100900408,
                                          100330192, 100868106, 101064143, 100806399, 100683934, 100892485, 100318969,
                                          100869201, 100894678, 100867001, 100864003, 100859133, 100969646, 100901508,
                                          100986751, 100917534, 100853698, 100634448, 100702350, 100870806, 100469219,
                                          100719157, 100869868, 100979847, 100863525, 100726497, 100865831, 100732362,
                                          100991386, 100853807, 100611593, 100516957, 100871770, 100021319, 100685882,
                                          100690812, 100999893, 100877840, 101058979, 100906090, 100932471, 100920388,
                                          100883880, 100277016, 100899964, 101034288, 100348047, 100326169, 100185886,
                                          100587912, 101031795, 100276920, 100772882, 100901296, 101058619, 100059274,
                                          101019113, 100798214, 100240976, 100867770, 100197482, 100274719, 100859108,
                                          100899428, 100635862, 101046334, 100124384, 100860963, 100214956, 101061015,
                                          100880146, 100882581, 100819981, 100737072, 100662763, 100222796, 100811872,
                                          100694312, 100715216, 100508910, 100856087, 100873566, 100360000, 100039005,
                                          100748109, 100272378, 100867678, 100859319, 100774333, 100880157, 100208234,
                                          100877732, 100994233, 100957031, 100249534, 100767359, 101080956, 100911335,
                                          100808789, 100892466, 100808697, 100870709, 101002007, 100906142, 100874459,
                                          100289739, 100891229, 100210646, 100826653, 100896930, 100473532, 101042534,
                                          100213302, 100329771, 100912742, 101044981, 100086985, 100218793, 101080897,
                                          100990183, 100860741, 100315877, 100337357, 100764454, 100387930, 100636238,
                                          100809987, 100867050, 100942135, 100865939, 100672274, 100706741, 100605867,
                                          100247754, 101056302, 100928885, 100639459, 100915311, 100169024, 100862655,
                                          100870295, 100981689, 100880534, 100854355, 100191902, 100848546, 100898205,
                                          100874955, 100882550, 100786127, 100442241, 100871968, 100894335, 100199927,
                                          100864235, 100879275, 100879894, 101023085, 100025641, 100735098, 100869570,
                                          101025513, 100121749, 100880225, 100632548, 100221305, 100825897, 100888718,
                                          101064882, 100868132, 100876093, 100815237, 100840826, 100288353, 101040174,
                                          100147617, 100992947, 100868278, 101006411, 100772995, 100777180, 101022207,
                                          101036920, 100885179, 100918719, 100360885, 100866351, 100745796, 100880746,
                                          100222256, 100897146, 100512342, 101034976, 100884906, 100848768, 101062578,
                                          100830860, 100894929, 100362108, 100882457, 100769248, 101065564, 100754040,
                                          100886325, 100270284, 100510289, 100933753, 100874866, 100938054, 100524843,
                                          101075388, 100891748, 100507927, 100672826, 100864634, 100900450, 100881299,
                                          100860582, 100519784, 100259957, 100643811, 100766841, 100811448, 100779181,
                                          101078616, 100333304, 100809901, 100899164, 100778547, 100014439, 100880651,
                                          100685107, 100307663, 100200726, 100871965, 100744708, 100302894, 100938489,
                                          100745864, 100908518, 100320572, 100265409, 101014139, 100007852, 100129208,
                                          101040880, 100879101, 100884749, 100872011, 100892964, 100255095, 100438483,
                                          100704957, 100823978, 101044942, 100491585, 100877791, 100807822, 100740959,
                                          100313142, 100301763, 101016736, 100423102, 100653028, 100171079, 100706310,
                                          100872543, 100870118, 100459962, 101069320, 100647247, 100612670, 100866195,
                                          100895532, 100728354, 100868648, 100403777, 100829534, 100247413, 100922857,
                                          100962272, 100873226, 100225097, 100137973, 100906681, 100804606, 100797401,
                                          100374743, 100940992, 100172133, 100833603, 101002058, 100871872, 100867080,
                                          100619126, 100789157, 100787841, 100232563, 100010586, 100895845, 100962860,
                                          100375148, 100716838, 100860152, 100987473, 100219371, 100859445, 101050376,
                                          100921159, 100818599, 100204467, 100879276, 101053846, 100691816, 100927855,
                                          101043105, 101005781, 100604491, 100376702, 100492008, 100300458, 100531921,
                                          100163402, 100894950, 100776246, 100974965, 100183934, 100040222, 100325420,
                                          100741556, 100860887, 100735819, 100900484, 100632639, 100394466, 100868250,
                                          100869320, 101041143, 100707710, 100930540, 100884112, 100364866, 100975525,
                                          100505515, 100739946, 100070263, 100653524, 100654215, 100892192, 100929352,
                                          100885295, 100881910, 100959988, 100869711, 100254782, 100772797, 100898423,
                                          100889837, 100788515, 100940768, 100814571, 100088829, 100887335, 100975215,
                                          100471784, 100261657, 100886429, 100887494, 100179990, 101058658, 100287083,
                                          100724354, 100876066, 100781818, 100513149, 100873870, 100408592, 100919091,
                                          100263726, 100877504, 100519951, 100845239, 100203763, 100367085, 100867895,
                                          100877974, 100998912, 100016835, 100225258, 100905293, 100486647, 101015605,
                                          100866826, 100803323, 100891139, 101080464, 100793915, 100902411, 100991552,
                                          100804866, 100331561, 100990399, 100868982, 100794955, 100096712, 100858695,
                                          100747080, 100753375, 100952343, 100781539, 101014828, 100202253, 100873029,
                                          100881072, 100299533, 100278751, 100530533, 100762727, 100671071, 101050000,
                                          100371918, 100169308, 101053387, 100464839, 100826475, 100888728, 100884331,
                                          100682718, 100181616, 100635874, 100018096, 100936311, 100760679, 100842798,
                                          100766857, 100197839, 100032304, 100969554, 100625913, 100927973, 100880120,
                                          100739206, 100757026, 100626401, 100827985, 100298332, 100690697, 101081787,
                                          100818941, 100871099, 100258834, 100890418, 100881103, 100869571, 100370157,
                                          100887376, 100938383, 100860196, 100979960, 100879589, 100929740, 101056158,
                                          100769958, 100838543, 100827761, 100595730, 100565347, 100825872, 100853747,
                                          100905532, 101035301, 100961925, 100215518, 100654855, 100298880, 100632143,
                                          100099586, 101076878, 100827458, 100846095, 100952989, 100796584, 100774164,
                                          100386871, 100200938, 100733289, 100684543, 100207276, 100788951, 100892037,
                                          100869494, 101001130, 100829806, 100301443, 100463760, 100799542, 100875827,
                                          100905895, 100852904, 100868305, 100880236, 101003384, 100012924, 100860608,
                                          100878358, 100375254, 100894523, 100651993, 100254192, 100994826, 100325034,
                                          100899122, 101076587, 100975467, 100996362, 100010539, 100523453, 100829371,
                                          100730781, 100913197, 100233931, 100758310, 100506639, 101074518, 100343331,
                                          100633772, 100448264, 100700259, 100878702, 100959084, 100893910, 100706950,
                                          100852405, 100846840, 100511979, 100869970, 100924294, 100967473, 101070423,
                                          100757581, 100222522, 100062430, 100853551, 100778974, 100494690, 100979767,
                                          100814161, 101004864, 100978042, 101021193, 100992534, 100625128, 100879761,
                                          100833048, 100302383, 100743562, 100878760, 101038680, 100814018, 100834027,
                                          100361454, 100686982, 100390327, 100532955, 100777956, 101066755, 100881546,
                                          100044216, 100894442, 100872982, 101061074, 101044844, 100763331, 101011730,
                                          100861967, 100845754, 100982533, 100631949, 100931888, 100873640, 100422198,
                                          100638306, 100931802, 100803304, 100591020, 100871514, 100958939, 101028199,
                                          100864986, 101027469, 100798994, 100403592, 101076963, 100727229, 100474757,
                                          100635459, 100501204, 100834794, 100744241, 100176349, 100779327, 100959901,
                                          100986914, 101028081, 100701088, 100895767, 100780251, 100982911, 100890701,
                                          100502164, 100861380, 100375698, 100894716, 100036890, 100796785, 101010445,
                                          100808185, 100846937, 100906406, 100747250, 100896805, 100925022, 100903367,
                                          100174909, 100895804, 100879284, 100868944, 100845439, 100746795, 100896241,
                                          100800065, 100984865, 100901937, 100024642, 100758925, 101008454, 100858825,
                                          100917590, 100864703, 100964401, 100419346, 100990995, 100256424, 100785419,
                                          101017583, 100857810, 101033455, 100894625, 100797554, 100880816, 100086585,
                                          101010249, 100953802, 100596484, 100030188, 100538089, 100258626, 100460144,
                                          100126450, 100975388, 100532455, 100887118, 100882193, 100905215, 100896598,
                                          100823915, 100898725, 100837180, 100894766, 100709154, 100880522, 100895643,
                                          100368043, 101018682, 100774250, 100391967, 100980703, 100757129, 101045492,
                                          100230139, 101030393, 100885675, 100744237, 101013408, 100423186, 100952359,
                                          100898336, 100903899, 100291738, 100861580, 101081782, 100625173, 101076380,
                                          100692260, 100818946, 101071253, 100292683, 100504973, 100817764, 100891968,
                                          100820082, 100894944, 100870971, 100947690, 100696802, 100858661, 100899142,
                                          100864689, 100878105, 100774693, 101067977, 100028417, 100835332, 100887767,
                                          100890225, 100043647, 100260317, 100814103, 100802612, 100898740, 100979558,
                                          100256830, 100220610, 100322755, 100819038, 100956898, 100488110, 100987091,
                                          101040243, 100465182, 100174168, 100234928, 100212311, 100739012, 101028112,
                                          100999557, 100730362, 100801532, 100877297, 100905382, 100866242, 101077486,
                                          100640954, 100075714, 100864089, 100908945, 100128968, 100444835, 100903681,
                                          101054417, 101053163, 100794943, 100806558, 100668288, 100772969, 100121360,
                                          100282212, 100904131, 100265320, 101008483, 100836197, 101064453, 100219547,
                                          100875485, 100689969, 101043063, 101054304, 100904607, 100266286, 100867916,
                                          100577228, 100029942, 100775932, 100784331, 100550274, 100845041, 100748833,
                                          100015585, 101020312, 100633834, 100798188, 100809446, 100921469, 100891758,
                                          100855748, 100839715, 100642539, 100256890, 100240610, 100142350, 101038703,
                                          100762065, 100989232, 100297251, 100251582, 100905331, 100912532, 100621112,
                                          100386924, 100848199, 100785959, 100194268, 100224498, 100935690, 100879734,
                                          100166845, 100607474, 100871972, 100252245, 100665066, 100774063, 100866712,
                                          100881135, 100904673, 100171163, 100947234, 100817391, 100818860, 100734200,
                                          100902653, 100889222, 100325892, 100879223, 100791311, 100368140, 101033120,
                                          100325060, 101076221, 100778474, 100619904, 100853437, 100685281, 100979965,
                                          100206298, 100784174, 100830102, 100223178, 100671982, 100735599, 100494198,
                                          100720324, 100742918, 101053298, 101002056, 101053468, 100532634, 100991162,
                                          100652798, 101040598, 100785170, 100316511, 100375313, 100870389, 100887230,
                                          100807155, 100798723, 100969430, 100895364, 100771237, 100458647, 100743986,
                                          100865577, 100301645, 100895614, 100903971, 100630229, 100923164, 100957378,
                                          100998651, 100752930, 101008631, 100288588, 101060009, 100719904, 100790368,
                                          100966669, 100256618, 101047404, 100874189, 100897644, 100955001, 100575783,
                                          100618297, 101050065, 100745226, 100905290, 100473129, 101081536, 100340186,
                                          100823062, 100875990, 100528114, 100796697, 100984542, 101079695, 100978114,
                                          100835345, 100824774, 100861995, 101012174, 100293544, 101000715, 100877581,
                                          101067112, 100984930, 101021000, 100964037, 100940397, 100242083, 100234000,
                                          101030319, 100755013, 100323633, 100950738, 100537540, 100807269, 100755016,
                                          100899559, 100391857, 101018372, 100847568, 100905671, 100883777, 100815110,
                                          101001421, 100787732, 100994822, 100075692, 101063119, 100331910, 100754940,
                                          100860074, 100875908, 100757097, 100859095, 100294628, 100673991, 100826676,
                                          100755689, 100759266, 100821578, 101012972, 100204304, 100055670, 100991060,
                                          100934466, 100176880, 101080089, 101036473, 100525611, 100139875, 100955297,
                                          100737549, 101031163, 100898090, 100291168, 100093365, 101015523, 100742978,
                                          100935616, 100620479, 100851643, 100094334, 100953033, 100174213, 100648426,
                                          100759804, 100825288, 100942573, 101078063, 100778898, 100295232, 100734920,
                                          100404645, 100678244, 100837911, 100621684, 100772844, 100907453, 100802303,
                                          100066526, 100299742, 100213357, 100872226, 100080611, 100835456, 100657850,
                                          100672930, 100081346, 100414992, 100807337, 100806218, 100280881, 100339323,
                                          101004899, 100618836, 100471177, 101078426, 100860797, 100801614, 100936218,
                                          100878027, 100202835, 100992651, 100894501, 100888963, 100808381, 100319159,
                                          100621359, 100639806, 101031928, 100877806, 100280760, 100777713, 100752185,
                                          100858019, 100808675, 100800278, 100731913, 100926021, 100936894, 101013931,
                                          101064325, 100845426, 100462989, 100004110, 101029888, 100890250, 100862877,
                                          100265267, 100810150, 100867877, 100297373, 100211209, 100824493, 100236534,
                                          100881496, 100957134, 100487639, 100887549, 100194739, 100875763, 100868613,
                                          100869392, 100857733, 100846602, 100626837, 100766047, 101001915, 100611333,
                                          100824854, 100866013, 100683976, 100771484, 100088198, 100819510, 100797789,
                                          100866348, 100864916, 100495793, 100685261, 101010385, 100900784, 100682001,
                                          100870152, 100888909, 100008814, 100765554, 100887281, 100859586, 100687725,
                                          100110168, 101028644, 100994948, 100587163, 100867139, 100430249, 101082365,
                                          100513018, 101061000, 100890836, 100904445, 100911717, 100821415, 100985989,
                                          100894308, 101079750, 101056869, 101067181, 100893360, 100532493, 100757043,
                                          100407499, 100960854, 100894820, 100800929, 101017426, 100173235, 100266802,
                                          101043596, 100800715, 100925624, 100875353, 100864073, 100897655, 100871752,
                                          100931136, 100880290, 100783723, 100894789, 100217245, 100832914, 100907535,
                                          100794728, 100860761, 100092998, 100909799, 100883896, 100766496, 101077299,
                                          100485994, 100875842, 100849650, 100868663, 100863920, 100790289, 100919729,
                                          100797261, 100901385, 100400360, 101056498, 101080574, 100842504, 100960501,
                                          100895869, 100889181, 100866581, 100245236, 100981130, 100875672, 100906914,
                                          100793745, 100809247, 100907967, 100905254, 100864023, 100469913, 100453397,
                                          101074913, 100758177, 100695814, 100959260, 100869009, 100924534, 100710442,
                                          101062344, 100780174, 101027051, 100749067, 100876515, 100252172, 100876904,
                                          100895636, 101067300, 100884257, 100865391, 100846458, 100973109, 100898980,
                                          100766705, 100944652, 100872882, 101042839, 100833959, 100884247, 100863956,
                                          101072072, 100937932, 100881581, 101035352, 100786447, 100231873, 100831219,
                                          100734248, 100977460, 100871644, 100509717, 100199142, 100898446, 100738830,
                                          100969728, 100350777, 101072054, 100886851, 100317788, 100865268, 100689653,
                                          101022051, 100266271, 100901262, 100896847, 100281379, 100085565, 100873072,
                                          100859787, 100881647, 100898229, 100880325, 100510251, 100531121, 100331107,
                                          100919679, 100865459, 100895270, 100882268, 101082373, 101025153, 100803349,
                                          100947167, 100397595, 100842028, 100392280, 101036800, 100744050, 100864168,
                                          100877208, 101081556)
                                        then 'B'
        end as user_group
                         from doeat_delivery_production.user u
                         join doeat_delivery_production.user_address ad on u.user_id = ad.user_id
                -- left join doeat_delivery_production.user_coupon c on u.user_id = c.user_id
-- where c.coupon_id=225 and c.status = 'VALID' and c.is_deleted=0
--         where ad.sigungu = '동작구' and date(u.created_at) < '2025-06-12'
                where user_group is not null
                )
select
    u.user_group
    , count(distinct u.user_id) as 전체_유저수
     , count(distinct a.user_id ) as 어플_진입_유저수
     , count(distinct b.user_id) as 주문_유저수
     , 어플_진입_유저수*100.0/NULLIF(전체_유저수,0) as aoc
    , 주문_유저수*100.0/NULLIF(어플_진입_유저수,0) as bc
from p_user u
left join (select
            o.user_id
            , count(distinct o.id) as order_cnt
            from doeat_delivery_production.orders o
            join doeat_delivery_production.team_order t ON o.team_order_id = t.id
            where o.sigungu in ('관악구', '동작구')
              and o.delivered_at is not null
              and t.is_test_team_order = 0
              and o.paid_at is not null
              and orderyn = 1
              and date(o.created_at) >= '2025-06-18'
            group by 1
           ) b on b.user_id = u.user_id
left join (select user_id
                , count(a.log_type) as log_cnt
                 from doeat_data_mart.user_log a
                where date(a.created_at) >= '2025-06-18'
                group by 1
                ) a on a.user_id = u.user_id
group by 1
order by 1




